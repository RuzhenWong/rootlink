/**
 * 关系链工具 - 支持多步路径链
 * 链格式（数组）：步骤序列，如 ["配偶","父"] ["母","弟"] ["父","姐"]
 */

const ONE_STEP = {
  '父': '父亲', '母': '母亲', '子': '儿子', '女': '女儿',
  '配偶': '配偶', '哥': '哥哥', '弟': '弟弟', '姐': '姐姐', '妹': '妹妹',
}

const TWO_STEP = {
  '父,父': '爷爷', '父,母': '奶奶',
  '父,哥': '伯父', '父,弟': '叔叔', '父,姐': '姑姑', '父,妹': '姑姑',
  '父,子': '弟弟', '父,女': '妹妹', '父,配偶': '继母',
  '母,父': '外公', '母,母': '外婆',
  '母,哥': '舅舅', '母,弟': '舅舅', '母,姐': '姨妈', '母,妹': '姨妈',
  '母,子': '弟弟', '母,女': '妹妹', '母,配偶': '继父',
  '子,子': '孙子', '子,女': '孙女', '子,配偶': '儿媳',
  '女,子': '外孙', '女,女': '外孙女', '女,配偶': '女婿',
  '配偶,父': '岳父/公公', '配偶,母': '岳母/婆婆',
  '配偶,哥': '大舅子/大伯', '配偶,弟': '小舅子/小叔',
  '配偶,姐': '大姨子/大姑', '配偶,妹': '小姨子/小姑',
  '配偶,子': '继子', '配偶,女': '继女',
  '哥,子': '侄子', '哥,女': '侄女', '哥,配偶': '嫂子',
  '弟,子': '侄子', '弟,女': '侄女', '弟,配偶': '弟媳',
  '姐,子': '外甥', '姐,女': '外甥女', '姐,配偶': '姐夫',
  '妹,子': '外甥', '妹,女': '外甥女', '妹,配偶': '妹夫',
}

const THREE_STEP = {
  '父,父,父': '曾祖父', '父,父,母': '曾祖母',
  '母,母,父': '外曾祖父', '母,母,母': '外曾祖母',
  '母,父,父': '外曾祖父', '母,父,母': '外曾祖母',
  '父,母,父': '祖外公', '父,母,母': '祖外婆',
  '子,子,子': '曾孙', '子,子,女': '曾孙女',
  '女,子,子': '外曾孙', '女,子,女': '外曾孙女',
  '子,子,配偶': '孙媳', '子,女,配偶': '外孙媳',
  '配偶,父,父': '配偶的爷爷', '配偶,父,母': '配偶的奶奶',
  '配偶,母,父': '配偶的外公', '配偶,母,母': '配偶的外婆',
  '配偶,父,哥': '配偶的伯父', '配偶,父,弟': '配偶的叔叔',
  '配偶,父,姐': '配偶的姑姑', '配偶,父,妹': '配偶的姑姑',
  '配偶,母,哥': '配偶的舅舅', '配偶,母,弟': '配偶的舅舅',
  '配偶,母,姐': '配偶的姨妈', '配偶,母,妹': '配偶的姨妈',
  '父,哥,子': '堂兄弟', '父,哥,女': '堂姐妹',
  '父,弟,子': '堂兄弟', '父,弟,女': '堂姐妹',
  '父,姐,子': '表兄弟', '父,姐,女': '表姐妹',
  '父,妹,子': '表兄弟', '父,妹,女': '表姐妹',
  '母,哥,子': '表兄弟', '母,哥,女': '表姐妹',
  '母,弟,子': '表兄弟', '母,弟,女': '表姐妹',
  '母,姐,子': '表兄弟', '母,姐,女': '表姐妹',
  '母,妹,子': '表兄弟', '母,妹,女': '表姐妹',
}

export function chainToName(chain) {
  if (!chain || chain.length === 0) return ''
  const key = chain.join(',')
  if (chain.length === 1) return ONE_STEP[key] || '亲属'
  if (chain.length === 2) return TWO_STEP[key] || '亲属'
  if (chain.length === 3) return THREE_STEP[key] || '亲属'
  return '亲属'
}

export function chainToDescription(chain) {
  if (!chain || chain.length === 0) return ''
  const lbl = { '父':'父亲','母':'母亲','子':'儿子','女':'女儿','配偶':'配偶','哥':'哥哥','弟':'弟弟','姐':'姐姐','妹':'妹妹' }
  return '对方是我的' + chain.map(s => lbl[s] || s).join('的')
}

/**
 * 根据已选步骤，返回下一步可选项
 */
export function nextStepOptions(prev) {
  const all = [
    { value: '父', label: '父亲' }, { value: '母', label: '母亲' },
    { value: '子', label: '儿子' }, { value: '女', label: '女儿' },
    { value: '配偶', label: '配偶' },
    { value: '哥', label: '哥哥' }, { value: '弟', label: '弟弟' },
    { value: '姐', label: '姐姐' }, { value: '妹', label: '妹妹' },
  ]
  if (prev.length === 0) return all
  if (prev.length >= 3) return []
  const last = prev[prev.length - 1]
  const rules = {
    '父': ['父','母','哥','弟','姐','妹','配偶'],
    '母': ['父','母','哥','弟','姐','妹','配偶'],
    '子': ['子','女','配偶'],
    '女': ['子','女','配偶'],
    '配偶': ['父','母','哥','弟','姐','妹','子','女'],
    '哥': ['子','女','配偶'],
    '弟': ['子','女','配偶'],
    '姐': ['子','女','配偶'],
    '妹': ['子','女','配偶'],
  }
  const allowed = rules[last] || []
  return all.filter(o => allowed.includes(o.value))
}

// 兼容旧代码
export const UP_OPTIONS = ['父', '母']
export const DOWN_OPTIONS = ['子', '女']
export const SIBLING_OPTIONS = ['哥', '弟', '姐', '妹']
export const CONNECTION_OPTIONS = ['直属', '伯伯', '叔叔', '姑姑', '舅舅', '姨妈']
